<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Sterowanie panelem LED</title>
</head>
<body>
    <h1>Sterowanie wyświetlaniem na panelu LED</h1>

    <h2>Wyświetl tekst</h2>
    <form id="textForm">
        <input type="text" name="text" placeholder="Wpisz tekst" required>
        <button type="submit">Wyświetl tekst</button>
    </form>

    <h2>Wyświetl GIF</h2>
    <form id="gifForm">
        <select name="gif" id="gifSelect" required>
            <option value="">Wybierz GIF</option>
        </select>
        <button type="submit">Wyświetl GIF</button>
    </form>

    <h2>Ustawienia</h2>
    <label>
        <input type="checkbox" id="centerCheckbox" checked> Centruj GIF-y
    </label>
    <br>
    <label>
        Jasność: <input type="range" id="brightnessSlider" min="1" max="100" value="100">
        <span id="brightnessValue">100</span>%
    </label>
    <br>
    <button onclick="applySettings()">Zastosuj ustawienia</button>

    <h2>Prześlij nowy GIF</h2>
    <form id="uploadForm" enctype="multipart/form-data">
        <input type="file" name="file" accept=".gif" required>
        <button type="submit">Prześlij</button>
    </form>

    <div id="message"></div>

    <script>
        function showMessage(msg, isError = false) {
            const div = document.getElementById('message');
            div.textContent = msg;
            div.style.color = isError ? 'red' : 'green';
            setTimeout(() => div.textContent = '', 3000);
        }

        // Ładowanie listy GIF-ów
        function loadGifs() {
            fetch('/get_gifs')
                .then(response => response.json())
                .then(gifs => {
                    const select = document.getElementById('gifSelect');
                    select.innerHTML = '<option value="">Wybierz GIF</option>';
                    gifs.forEach(gif => {
                        const option = document.createElement('option');
                        option.value = gif;
                        option.textContent = gif;
                        select.appendChild(option);
                    });
                });
        }

        // Formularz tekstu
        document.getElementById('textForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            fetch('/set_text', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'ok') {
                    showMessage(data.message);
                } else {
                    showMessage(data.message, true);
                }
            });
        });

        // Formularz GIF-a
        document.getElementById('gifForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            fetch('/set_gif', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'ok') {
                    showMessage(data.message);
                } else {
                    showMessage(data.message, true);
                }
            });
        });

        // Formularz uploadu
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            fetch('/upload_gif', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'ok') {
                    showMessage(data.message);
                    loadGifs(); // Odśwież listę
                } else {
                    showMessage(data.message, true);
                }
            });
        });

        // Ustawienia
        document.getElementById('brightnessSlider').addEventListener('input', function() {
            document.getElementById('brightnessValue').textContent = this.value;
        });

        function applySettings() {
            const center = document.getElementById('centerCheckbox').checked;
            const brightness = document.getElementById('brightnessSlider').value;

            // Wyślij centrowanie
            fetch('/set_center', {
                method: 'POST',
                body: new URLSearchParams({ center: center })
            })
            .then(response => response.json())
            .then(data => showMessage(data.message));

            // Wyślij jasność
            fetch('/set_brightness', {
                method: 'POST',
                body: new URLSearchParams({ brightness: brightness })
            })
            .then(response => response.json())
            .then(data => showMessage(data.message));
        }

        // Ładuj GIF-y przy starcie
        loadGifs();
    </script>
</body>
</html>